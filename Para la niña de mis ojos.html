<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Árbol de corazones – frase romántica</title>
  <style>
    :root{
      --bg-1:#1b1b2f;   /* cielo profundo */
      --bg-2:#162447;   /* degradado cielo */
      --bg-3:#0f3460;   /* horizonte */
      --ground:#1e5631; /* pasto */
      --trunk:#4a2c2a;  /* tronco */
      --heart:#ff4d6d;  /* corazones principales */
      --heart2:#ff8fab; /* corazones secundarios */
      --glow:#ffd2e1;   /* brillo de corazones */
      --text:#ffe4ec;   /* frase */
    }
    html,body { height:100%; margin:0; background:#0e1326; color:#fff; }
    body { display:grid; place-items:center; }
    .wrap{
      width:min(100vw, 1000px);
      height:min(100vh, 700px);
      position:relative;
    }
    canvas{ width:100%; height:100%; display:block; border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,.45); }
    .hint{
      position:absolute; inset:auto 12px 10px auto; font:12px/1.2 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:#cdd6f4; opacity:.8;
      background:rgba(0,0,0,.25); padding:6px 10px; border-radius:10px; backdrop-filter: blur(4px);
    }
    .hint b{ color:#fff; font-weight:700 }
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="scene"></canvas>
    <div class="hint">Haz <b>clic</b> o presiona <b>R</b> para replantar corazones · Arrastra para <b>viento</b></div>
  </div>

  <script>
  // ==================== CONFIGURACIÓN ====================
  const CONFIG = {
    frase: 'Mirarte es como mirar el cielo más hermoso. Te mereces todo. ❤',
    fuenteFrase: '700 30px "Georgia", "Times New Roman", serif', // cambia tamaño y fuente
    corazonColores: ['var(--heart)','var(--heart2)'],
    cantidadCorazones: 260,      // hojas-corazón
    profundidadRamas: 8,         // 7–9 queda bien
    vientoSuavidad: 0.012,       // 0 = fijo, 0.01–0.03 = brisa
    brilloCorazon: true,         // efecto glow
    semillaAleatoria: Date.now() // cambia para otro árbol; se ajusta al hacer clic
  };
  // =======================================================

  const canvas = document.getElementById('scene');
  const ctx = canvas.getContext('2d');

  // Escalado para alta densidad (retina)
  function resize(){
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const {clientWidth:w, clientHeight:h} = canvas;
    canvas.width = w * dpr;
    canvas.height = h * dpr;
    ctx.setTransform(dpr,0,0,dpr,0,0); // trabajamos en CSS px
  }

  // PRNG simple con semilla para reproducibilidad
  function rng(seed){
    let s = seed >>> 0;
    return () => (s = (s * 1664525 + 1013904223) >>> 0, (s & 0xfffffff) / 0xfffffff);
  }

  // Dibuja un corazón en (x,y) con tamaño s y rotación r
  function heart(ctx, x, y, s, r, fill, glow=true){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(r);
    ctx.scale(s,s);
    if(glow){
      ctx.shadowBlur = 14;
      ctx.shadowColor = getComputedStyle(document.documentElement).getPropertyValue('--glow').trim();
    } else {
      ctx.shadowBlur = 0;
    }
    ctx.beginPath();
    // Curvas paramétricas del corazón
    // Usamos dos arcos y triángulo inferior (forma clásica)
    ctx.moveTo(0,0);
    const w=1, h=1.1;
    ctx.beginPath();
    ctx.moveTo(0, -0.3*h);
    ctx.bezierCurveTo( -0.8*w, -1.2*h, -1.75*w, 0.35*h, 0, 1.2*h);
    ctx.bezierCurveTo( 1.75*w, 0.35*h, 0.8*w, -1.2*h, 0, -0.3*h);
    ctx.closePath();
    ctx.fillStyle = fill;
    ctx.fill();
    ctx.restore();
  }

  // Árbol recursivo
  function drawBranch(x, y, len, angle, width, depth, leaves, rand, windT){
    if(depth <= 0 || len < 6){
      // colocar corazón (hoja)
      const sway = Math.sin(windT + x*0.01 + y*0.013) * 0.12; // leve vaivén por viento
      const size = 5 + rand()*7;
      const rot = -Math.PI/2 + (rand()*0.6 - 0.3) + sway*0.5;
      const color = CONFIG.corazonColores[(rand()*CONFIG.corazonColores.length)|0];
      leaves.push({x, y, size, rot, color});
      return;
    }
    ctx.save();
    ctx.lineCap = 'round';
    ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--trunk').trim();
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(x, y);

    const wind = Math.sin(windT + y*0.02) * (0.5 + len*0.002);
    const nx = x + Math.cos(angle + wind*CONFIG.vientoSuavidad) * len;
    const ny = y - Math.sin(angle + wind*CONFIG.vientoSuavidad) * len;

    ctx.lineTo(nx, ny);
    ctx.stroke();
    ctx.restore();

    // bifurcaciones
    const n1 = len * (0.72 + rand()*0.06);
    const n2 = len * (0.62 + rand()*0.08);
    const a1 = angle + (0.35 + rand()*0.25);
    const a2 = angle - (0.30 + rand()*0.28);
    const w1 = Math.max(1, width*0.78);
    const w2 = Math.max(1, width*0.72);

    drawBranch(nx, ny, n1, a1, w1, depth-1, leaves, rand, windT);
    drawBranch(nx, ny, n2, a2, w2, depth-1, leaves, rand, windT);

    // rama central ocasional
    if(rand() < 0.28){
      const n3 = len * (0.55 + rand()*0.12);
      const a3 = angle + (rand()*0.3 - 0.15);
      const w3 = Math.max(1, width*0.7);
      drawBranch(nx, ny, n3, a3, w3, depth-1, leaves, rand, windT);
    }
  }

  // Fondo (cielo + suelo)
  function drawBackground(w, h){
    const g = ctx.createLinearGradient(0,0,0,h);
    const cs = getComputedStyle(document.documentElement);
    g.addColorStop(0, cs.getPropertyValue('--bg-1').trim());
    g.addColorStop(0.6, cs.getPropertyValue('--bg-2').trim());
    g.addColorStop(1, cs.getPropertyValue('--bg-3').trim());
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);

    // estrellas suaves
    for(let i=0;i<80;i++){
      const x = Math.random()*w, y = Math.random()*h*0.6, r = Math.random()*1.5;
      ctx.globalAlpha = 0.25 + Math.random()*0.5;
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fillStyle = '#ffffff'; ctx.fill();
    }
    ctx.globalAlpha = 1;

    // suelo
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--ground').trim();
    ctx.beginPath();
    ctx.moveTo(0, h*0.86);
    ctx.bezierCurveTo(w*0.25,h*0.82, w*0.75,h*0.92, w, h*0.88);
    ctx.lineTo(w, h); ctx.lineTo(0,h); ctx.closePath(); ctx.fill();
  }

  // Texto romántico
  function drawPhrase(w, h){
    const cs = getComputedStyle(document.documentElement);
    ctx.save();
    ctx.fillStyle = cs.getPropertyValue('--text').trim();
    ctx.font = CONFIG.fuenteFrase;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    const maxWidth = Math.min(w*0.8, 760);
    wrapText(CONFIG.frase, w/2, h*0.13, maxWidth, 36);
    ctx.restore();
  }

  // Saltos de línea automáticos
  function wrapText(text, x, y, maxWidth, lineHeight){
    const words = text.split(' ');
    let line = '';
    let yy = y;
    for(let n=0; n<words.length; n++){
      const test = line + words[n] + ' ';
      const metrics = ctx.measureText(test);
      if(metrics.width > maxWidth && n>0){
        ctx.fillText(line.trim(), x, yy);
        line = words[n] + ' ';
        yy += lineHeight;
      } else {
        line = test;
      }
    }
    ctx.fillText(line.trim(), x, yy);
  }

  // Animación principal
  let t = 0, dragging = false, windDrag = 0;
  const state = { leaves: [], seed: CONFIG.semillaAleatoria };
  function render(){
    const w = canvas.clientWidth, h = canvas.clientHeight;
    drawBackground(w,h);

    // suelo suave y sombra del árbol
    ctx.save();
    ctx.globalAlpha = 0.2;
    ctx.fillStyle = '#000';
    ctx.beginPath();
    ctx.ellipse(w*0.5, h*0.86, 120, 16, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();

    // árbol
    const rand = rng(state.seed);
    state.leaves.length = 0;
    const trunkLen = Math.min(w, h) * 0.28 + 40;
    const trunkWidth = Math.max(6, Math.min(w,h)*0.02);
    const baseX = w*0.5, baseY = h*0.86;

    drawBranch(baseX, baseY, trunkLen, Math.PI/2, trunkWidth, CONFIG.profundidadRamas, state.leaves, rand, t + windDrag);

    // corazones
    for(const L of state.leaves){
      const breathe = (Math.sin(t*1.4 + L.x*0.02 + L.y*0.015)+1)*0.04 + 0.98;
      heart(ctx, L.x, L.y, (L.size/10)*breathe, L.rot, L.color, CONFIG.brilloCorazon);
    }

    // frase
    drawPhrase(w,h);

    // partículas flotantes sutiles
    ctx.save();
    ctx.globalAlpha = 0.25;
    for(let i=0;i<30;i++){
      const px = (i*67 + (t*20)%w) % w;
      const py = (i*131 % (h*0.6)) + Math.sin(t + i)*8 + 30;
      ctx.beginPath(); ctx.arc(px,py,1.2,0,Math.PI*2); ctx.fillStyle = '#ffffff'; ctx.fill();
    }
    ctx.restore();

    // amortiguación del arrastre (viento temporal)
    windDrag *= 0.96;
    t += 0.016;
    requestAnimationFrame(render);
  }

  // Interacción
  function replant(){
    state.seed = Math.floor(Math.random()*1e9);
  }
  canvas.addEventListener('click', replant);
  window.addEventListener('keydown', e => { if(e.key.toLowerCase()==='r') replant(); });
  canvas.addEventListener('pointerdown', ()=> dragging=true);
  window.addEventListener('pointerup', ()=> dragging=false);
  window.addEventListener('pointermove', e=>{
    if(dragging){
      windDrag += (e.movementX + e.movementY)*0.0015;
    }
  });

  // Preparar lienzo y arrancar
  function start(){
    const wrap = document.querySelector('.wrap');
    // Forzamos un tamaño razonable en desktop si la ventana es muy grande
    wrap.style.height = Math.min(window.innerHeight*0.9, 700) + 'px';
    wrap.style.width  = Math.min(window.innerWidth*0.96, 1000) + 'px';
    resize();
    render();
  }
  window.addEventListener('resize', resize);
  start();
  </script>
</body>
</html>
